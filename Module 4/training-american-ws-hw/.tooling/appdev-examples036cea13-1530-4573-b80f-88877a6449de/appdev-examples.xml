<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:vm="http://www.mulesoft.org/schema/mule/vm" xmlns:http="http://www.mulesoft.org/schema/mule/http"
	xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/vm http://www.mulesoft.org/schema/mule/vm/current/mule-vm.xsd">
	<http:listener-config name="HTTP_Listener_config" doc:name="HTTP Listener config" doc:id="b240a64c-491c-4415-883d-a21df5dfece7" >
		<http:listener-connection host="0.0.0.0" port="8081" />
	</http:listener-config>
	<http:request-config name="HTTP_Request_configuration" doc:name="HTTP Request configuration" doc:id="f50cebbf-b1a5-4a8b-b32c-519cf6110138">
		<http:request-connection host="localhost" port="8081" />
	</http:request-config>
	<vm:config name="VM_Config" doc:name="VM Config" doc:id="821a5554-03a8-42f4-8930-6114d3488e18" >
		<vm:queues >
			<vm:queue queueName="goodbyeQ" />
		</vm:queues>
	</vm:config>
	<flow name="privateflow" doc:id="d7ed541a-e0cc-4450-91fc-31b738f84676" >
		<http:request method="GET" doc:name="GET /goodbye" doc:id="93d7f0bd-e0b9-4b38-8bb9-bb102fe96282" config-ref="HTTP_Request_configuration" path="/goodbye" responseTimeout="300000">
			<http:query-params><![CDATA[#[output application/java
---
{
	"firstname" : attributes.queryParams.fname
}]]]></http:query-params>
		</http:request>
	</flow>
	<sub-flow name="subflow" doc:id="557f3a66-fb9c-4ef0-8af3-6ef4691e369a" >
		<set-payload value="Hello" doc:name="Hello" doc:id="841d4806-c90c-464a-938b-cce136205881" />
		<set-variable value="#[attributes.queryParams.lname]" doc:name="Set Variable" doc:id="8b878552-e5dc-42d6-b4d9-158a1f528ed3" variableName="lastname" />
	</sub-flow>
	<flow name="helloFlow" doc:id="234a7f14-6101-4cbb-b6a1-3e7e75402c2c" >
		<http:listener doc:name="GET /hello" doc:id="9a9e31f2-b4f0-48f1-a96d-749cb279090a" config-ref="HTTP_Listener_config" path="/hello" allowedMethods="GET">
			<http:response statusCode="200" reasonPhrase="Success">
				<http:headers ><![CDATA[#[output application/java
---
{
	"lastname" : vars.lastname
}]]]></http:headers>
			</http:response>
		</http:listener>
		<flow-ref doc:name="subflow" doc:id="d2a12487-7c0f-424c-a026-ca3b450c10fa" name="subflow" />
		<vm:publish queueName="" doc:name="Publish" doc:id="dd49c458-f256-4bf6-bc4e-e5123c046808" />
		<logger level="INFO" doc:name="Logger" doc:id="85ca5c3d-d910-495f-9807-d17fbc36f617" />
	</flow>
	<flow name="goodbyeFlow" doc:id="4b70e975-faa9-4e8c-9004-9f205aeb4dd7" >
		<http:listener doc:name="GET /goodbye" doc:id="f3a0cff3-bf9d-453b-947f-95e7a1b39931" config-ref="HTTP_Listener_config" path="/goodbye" allowedMethods="GET"/>
		<set-payload value='#["Goodbye " ++ (attributes.queryParams.firstname default "Maxine" )]' doc:name="Goodbye" doc:id="68e1bbb1-6711-440e-b708-2dc3fa2d117a" />
		<logger level="INFO" doc:name="payload" doc:id="0e26654e-0b85-4784-8413-f626a722e3d3" message="#[payload]"/>
	</flow>
</mule>
